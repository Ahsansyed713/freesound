<div id="center">
	<div id="fig">
    	<script type="text/javascript+protovis">
var data = {{ data|safe }};

var vis = new pv.Panel()
				.def("i", -1)
    			.width(205)
    			.height(data.length * 160)
				.bottom(0)
				.top(0)
				.right(15);

var arc = vis.add(pv.Layout.Arc)
    .nodes(data.nodes)
    .links(data.links)
	.orient("right");
/*
    .sort(function(a, b) a.group == b.group
        ? b.linkDegree - a.linkDegree
        : b.group - a.group);
*/
arc.link.add(pv.Line)
   .strokeStyle(function(d, p)  connections(d,p));

function connections(d, p) {

	if (p.sourceNode.active == true) {
		$("#"+p.targetNode.id+"").animate({backgroundColor: "#"+p.targetNode.color+""});
		$("#"+p.sourceNode.id+"").animate({backgroundColor: "#"+p.sourceNode.color+""});
		return "orange";
	} else if (p.targetNode.active == true) {	
		$("#"+p.targetNode.id+"").animate({backgroundColor: "#"+p.targetNode.color+""});
		$("#"+p.sourceNode.id+"").animate({backgroundColor: "#"+p.sourceNode.color+""});
		return "orange";
	} else
		return "#c7c7c7";
}

arc.node.add(pv.Dot)
    .size(function(d) d.linkDegree + 4)
    // .fillStyle(pv.Colors.category19().by(function(d) d.group))
	.fillStyle(function(d) d.color)
    .strokeStyle(function() this.fillStyle().darker())
    .radius(function() vis.i() == this.index ? 10 : 5)
    .event("mouseover", function(d) (d.active = true, arc, vis.i(this.index)))
    .event("mouseout", function(d) (clearBackgrounds(), d.active = false, arc, vis.i(-1)))
	.event("click", function(d) goToSound(d.id,d.username));

function goToSound(soundId, username) {
	window.location.href("/people/"+username+"/sounds/"+soundId);
}

// arc.label.add(pv.Label)
vis.render();

function clearBackgrounds() {
	for (var i=0; i<data.nodes.length; i++) {
		$("#"+data.nodes[i].id+"").animate({backgroundColor: "#ffffff"});
	}
}
    	</script>
  	</div>
</div>  	

  