{% extends "accounts/_people.html" %}
{% load bookmark_form %}
{% load paginator %}
{% block title %}{% if owner %}Your bookmarks{% else %}Bookmarks by {{user.username}}{% endif %}{% endblock %}
{% block section_content %}


<script type="text/javascript">
    var selected_ids = []
    
    function toggle_bookmark_id(id)
    {
        if (selected_ids.indexOf(id) != -1){
	    selected_ids.splice (selected_ids.indexOf(id),1);
	}else{
	    selected_ids.push(id)
	}
    }
    
    function collect_ids(){
	$("#id_list_ids").val(selected_ids.toString())
    }
    
    function select_all(){
	{% for bookmark in page.object_list %}
	    if ($("#id_check_{{bookmark.id}}").attr("checked")==false){
		$("#id_check_{{bookmark.id}}").attr("checked", !$("#id_check_{{bookmark.id}}").attr("checked"))
		toggle_bookmark_id({{bookmark.id}})
	    }
	{% endfor %}
    }
    
    function select_none(){
	{% for bookmark in page.object_list %}
	    if ($("#id_check_{{bookmark.id}}").attr("checked")==true){
		$("#id_check_{{bookmark.id}}").attr("checked", !$("#id_check_{{bookmark.id}}").attr("checked"))
		toggle_bookmark_id({{bookmark.id}})
	    }
	{% endfor %}
    }
    
</script>


<h1>{% if owner %}Your bookmarks{% else %}Bookmarks by <a href="{% url account user.username%}">{{user.username}}</a>{% endif %}</h1>
<div id="content">
    {% if all %}
        <h3>All bookmarks</h3>
    {% else %}
    {% if uncategorized %}
	<h3>Uncategorized bookmarks</h3>
    {% else %}
    {% if category %}
	<h3>Bookmarks in "{{category.name}}"</h3>
    {% endif %}
    {% endif %}
    {% endif %}
    
    {% if bookmarked_sounds %}
	
	{% show_paginator paginator page current_page request "bookmark" %}
	
	{% if owner %}
	<div style="margin-top:-25px;margin-bottom:32px">
	    <p style="margin-top:-15px;margin-bottom:0px">Select <a onclick="select_all()">all</a>/<a onclick="select_none()">none</a></p>
	</div>
	{% endif %}
	
	<div style="margin-top:-15px;margin-bottom:15px">
	{% for bookmark in page.object_list %}
	    
	    <div>
		
	    {% if owner %}
	    <div class="infowindow_player" style="width:15px;height:20px;vertical-align:top;display:inline-block">
	        <input onchange="toggle_bookmark_id({{bookmark.id}})" id="id_check_{{bookmark.id}}" name="check_{{bookmark.id}}" type="checkbox">
	    </div>
	    {% endif %}
	    
	    {% with bookmark.sound as sound%}
		<div class="infowindow_player" style="width:45px;height:20px;display:inline-block">
		    {% include "sounds/player_small.html" %}
		</div>
	    {% endwith %}
	    
	    <div style="width:475px;height:25px;vertical-align:middle;font-size:12px;display:inline-block">
		{% if bookmark.name %}{{bookmark.name}} ({% endif %}<a href="{% url sound bookmark.sound.user.username bookmark.sound.id %}">{{bookmark.sound.original_filename}}</a>{% if bookmark.name %}){% endif %} by <a href="{% url account bookmark.sound.user.username %}">{{bookmark.sound.user.username}}</a>
	    </div>
	    
	    </div>
   
	{% endfor %}
	</div>
	{% show_paginator paginator page current_page request "bookmark" %}
	
    {% else %}
	<p>
	    There are no bookmarks {% if category or uncategorized %}in this category{% endif %}
	</p>	
    {% endif %}

        
</div><!-- #content -->

<div id="sidebar">
   
    <div id="bookmark_categories" class="content_box">
        <h3>{% if owner %}My{% else %}{{user.username}}'s{% endif %} bookmark categories</h3>
 
	{% if bookmark_categories %}
	    <ul>
		<li><a href="{% url bookmarks-for-user user.username %}" {% if all %}style="font-weight:bold"{% endif %}>All bookmarks</a> ({{n_all}} bookmark{{ n_all|pluralize }})</li>
		<li><a href="{% url bookmarks-for-user-uncategorized user.username %}" {% if uncategorized %}style="font-weight:bold"{% endif %}>Uncategorized bookmarks</a> ({{n_uncat}} bookmark{{ n_uncat|pluralize }})</li>
		
	    {% for cat in bookmark_categories %}
		<li><a href="{% url bookmarks-for-user-for-category user.username cat.id %}" {% if category.id = cat.id %}style="font-weight:bold"{% endif %}>{{cat.name}}</a> ({{cat.bookmarks.count}} bookmark{{ cat.bookmarks.count|pluralize }})
		
		{% if owner %} <a href="{% url delete-bookmark-category user.username cat.id %}{% if cat.id != category.id %}?next={{request.path}}?page={{current_page}}{% endif %}"><img  style="vertical-align: bottom;" src="{{media_url}}images/cancel.png" width="16" height="16" alt="Delete {{cat.name}} category"/></a>{% endif %}</li>
		
	    {% endfor %}
	    </ul>
	{% else %}
	    <p>
		{% if owner %}You haven't created any bookmark categories yet{% else %}<a href="{% url account user.username%}">{{user.username}}</a> hasn't created any bookmark categories yet{% endif %}
	    </p>
	{% endif %}
	
    </div><!-- #bookmark_categories -->
    
    {% if owner %}
    <div id="actions" class="content_box">
    <h3>Organize your bookmarks</h3>
    <p>Create a new category:</p>
    <form action="" method="post" style="margin-left:-10px;margin-top:-10px">{% csrf_token %}
	<p style="margin-top:-10px">
	    Name: {{form_bookmark_category.name}}
	    <input type="submit" value="Create" name="create_cat" style="float:right;margin-top:8px"/>
	    <br style="clear"/>
	</p>
    </form>
    
    
    <p>Select multiple bookmarks from the list on the left and perform one of the following actions:</p>
    <form action="" method="post" style="margin-left:-10px;margin-top:-10px" onsubmit="collect_ids()">{% csrf_token %}
	
	<p style="margin-top:-10px">
	    <select name="actions_list" id="id_actions_list" style="width:285px">
		<option value=-1>-- None --</option>
		<option value="del">Delete bookmarks</option>
		{% if category %}	
		    <option value="rem_cat_{{category.id}}">Remove bookmarks from category "{{category.name}}"</option>
		{% endif %}
		{% if bookmark_categories %}
		    <option value=-1>Add category...</option>
		    {% for cat in bookmark_categories %}
			<option value="add_cat_{{cat.id}}">&nbsp&nbsp&nbsp&nbsp {{cat.name}}</option>
		    {% endfor %}
		{% endif %}
	    </select>
	    <input type="hidden" value="" id="id_list_ids" name="list_ids">
	    <input type="submit" value="Perform the action" name="action" style="float:right;margin-top:8px"/>
	    <br style="clear"/>
	</p>
    </form>
    </div>
    {% comment %}
    </div><!-- #attribution_list -->
	
    
	<div id="attribution_list" class="content_box">
	<h3>Attribution</h3>
    
	<p>TODO: attribution list for the category</p>
	
    </div><!-- #add_bookmark_categories -->
    {% endcomment %}
    
    {% endif %}

   
</div><!-- #sidebar -->

<br class="clear"/><!-- Need a clearing element for some reason here.. -->
{% endblock %}
