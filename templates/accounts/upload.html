{% extends "base.html" %}
{% load absurl %}

{% block title %}upload files{% endblock %}

{% block head %}
    {{ block.super }}
    <style type="text/css">
    #upload-progress-container
    {
        border: 1px solid #aaa;
        margin-top: 20px;
        background: #eee;
        padding: 5px;
        width:650px;
    }

    div.queue-container
    {
        padding: 1px;
        margin-left: 4px;
    }

    div.progress-container
    {
        clear:both;
        float: left;
        border: 1px solid #aaa;
        width: 250px;
        margin-top:8px;
        margin-right: 5px;
    }
    div.progress
    {
        height:9px;
        width: 0%;
        background-image: url('{{media_url}}images/progress.gif');
        background-repeat: repeat-x;
    }

    div.progress-done
    {
        height:9px;
        background-color: #fdc735;
        background-image: none;
        width: 100%;
    }

    div.progress-failed
    {
        height:9px;
        background-color: #bd2d33;
        background-image: none;
        width: 100%;
    }

    span.cancel-container img
    {
        vertical-align:bottom;
    }
    span.filename
    {
        font-size: 12px;
        margin-top: 2px;
    }
    .please_note
    {
        width: 200px;
        height: 160px;
        background-color: #fefefe;
        padding: 0 10px 0 10px;
        margin: 5px;
        float: left;
        border: 1px solid #eee;
        border-top: 0px;
    }
    .please_note h3 {
        margin-left: 5px;
    }

    #describe_button_block{
        display:block;
        text-align:center;
        float:right;
        margin-right:120px;
        width:320px;
        color:gray;

    }
    #upload_button_block{
        display:block;
        text-align:center;
        float:left;
        margin-left:120px;
        width:320px;
        color:gray;

    }

    #buttons_container
    {

        width: 100%;
        height: 130px;
    }

    .html_upload_form{
    	margin-left: 0px;
		padding: 0px;
		border-left: none;
		background: white;
		margin-bottom: 20px;
		text-align:left;
    }
    .centered{
    	text-align:center;
    }

    </style>
{% endblock %}

{% block content %}

<div id="upload_page">
{% comment %}<h1>Upload files</h1>{% endcomment %}
<p>
    <em><h2>Please note before uploading..</h2></em>
</p>
<div>
    <div class="please_note content_box">
        <h3>Legality</h3>
        <p>Only upload sounds created or recorded <strong>by you</strong>. <em><a href="{% url wiki-page "faq" %}#sounds-4">More details...</a></em>
    </div>
    <div class="please_note content_box">
        <h3>Sounds only</h3>
        <p>Freesound is for <strong>sounds</strong> only. Self-created <strong>music fragments/samples/loops</strong> are also ok, but not
            complete songs or compositions.
    </div>
    <div class="please_note content_box">
        <h3>Moderation</h3>
        <p>All files are <strong>moderated</strong>. If you upload illegal files or files that don't follow the <a href="{% url wiki-page "faq" %}#sounds">guidelines</a> they will be removed.
    </div>
    <div class="please_note content_box">
        <h3>Formats</h3>
        <p>We prefer <strong>wav, aif and flac</strong>, but we support ogg and mp3 too. For very large files please use some compressed format. Uploading more than 1GB at once will fail.
    </div>

    <br style="clear: both;">
</div>
<br>
<br>



<div id="buttons_container">
<div id="upload_button_block">

{% if no_flash %}
  <form method="POST" enctype="multipart/form-data" action="/home/upload/html/" class="html_upload_form"
  onSubmit="document.getElementById('html_upload_button').disabled = true">{% csrf_token %}
    {{ form.as_p }}
    <ul id="file-list" class="file-list"></ul>
    <input type="button" id="add-files-btn" value="Add files" />
    <input type="submit" value="Upload" id="html_upload_button" />
  </form>
{% if successes %}
  <p>
  <br/>
  <b>{{ successes }} file{{ successes|pluralize }} uploaded successfully</b>
  </p>
{% endif %}

{% if errors %}
  {% with count=errors.count %}
  <p>
  <b>There was an error uploading the file{{ count|pluralize }}:</b>
    <ul> {% for file in errors %}<li>{{ file }}</li>{% endfor %}</ul>
  </p>
  {% endwith %}
{% endif %}
{% else %}
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="160" height="31" id="uploader">
    <param name="movie" value="{{media_url}}swf/upload.swf" />
    <param name="flashvars" value="sessionid={{request.session.session_key}}" />
    <param name="AllowScriptAccess" value="always" />
    <!--[if !IE]>-->
    <object type="application/x-shockwave-flash" data="{{media_url}}swf/upload.swf" width="160" height="31">
        <param name="flashvars" value="sessionid={{request.session.session_key}}" />
        <param name="AllowScriptAccess" value="always" />
        <!--<![endif]-->
        <p>
            If you install <a href="http://www.adobe.com/go/getflashplayer">flash player 10</a> you will be able to upload multiple files in one go!<br/>
        </p>
        <form method="POST" enctype="multipart/form-data" action="/home/upload/file/">
            <input type="hidden" name="sessionid" value="{{ request.session.session_key }}" />
            <input type="file" name="file" /><br/>
            <input type="submit" value="upload" />
        </form>
        <!--[if !IE]>-->
    </object>
    <!--<![endif]-->
</object>
<p>
<img src="{{media_url}}/images/fugue-icons/icons/exclamation.png"> <span style="color:black">Don't leave before upload finishes!</span><br/>
Hint: you can upload multiple files at once</p>
{% endif %}

</div>

<div id="describe_button_block">

<p><a id="describe_a" href="{% url accounts-describe %}"><img id="describe_img" src="{{media_url}}images/describe_sounds.png" width="160" height="31" alt="Describe Your Sounds Link" /></a></p>
<p>Before your sounds show up on the web site you'll have to describe them</p>
</div>
</div>
<div id="upload-progress-container" style="display:none">
<span style="clear:both"/>
</div>
<br/>


<p class="centered">
{% if no_flash %}
<a href="{% url accounts-upload %}"> switch to flash version </a>
{% else %}
<a href="{% url accounts-upload-html %}"> switch to non-flash version </a>
{% endif %}
</p>
</div><!-- #upload_page -->
{% if no_flash %}
<script>
  function getCookie(c_name) {
      var c_value = " " + document.cookie;
      var c_start = c_value.indexOf(" " + c_name + "=");
      if (c_start == -1) {
          c_value = null;
      }
      else {
          c_start = c_value.indexOf("=", c_start) + 1;
          var c_end = c_value.indexOf(";", c_start);
          if (c_end == -1) {
              c_end = c_value.length;
          }
          c_value = decodeURI(c_value.substring(c_start,c_end));
      }
      return c_value;
  }
  var appState = (function appState() {
    var removeDuplicates = function removeDuplicates(array, currentFile) {
      var isSameFile = function isSameFile(file) {
        return file.size === currentFile.size && file.name === currentFile.name;
      };
      var isSoundInSoundsQueue = !!array.filter(isSameFile).length;
      if (!isSoundInSoundsQueue) {
        return array.concat(currentFile);
      } else {
        return array;
      }
    };
    var onFileInputChange = function onFileInputChange(event) {
      var receivedFiles = event.target.files || event.dataTransfer.files;
      for (var i = 0; i < receivedFiles.length; i++) {
        soundsQueue.push(receivedFiles[i]);
      }
      soundsQueue = soundsQueue.reduce(removeDuplicates, []);
      var ul = document.getElementById('file-list');
      ul.innerHTML = '';
      soundsQueue.forEach(function(soundFile) {
        var node = document.createElement("LI");
        var textNode = document.createTextNode(soundFile.name);
        node.appendChild(textNode);
        ul.appendChild(node);
      });
    };

    var soundsQueue = [];
    var fileInput = document.getElementById('id_files');
    var addFilesButton = document.getElementById('add-files-btn');
    addFilesButton.onclick = function onclick() { fileInput.click(); };
    fileInput.onchange = onFileInputChange;
    fileInput.style.display = 'none';
    return {
      get soundsQueue() {
        return soundsQueue;
      }
    }
  })();
</script>
{% endif %}
{% endblock %}
