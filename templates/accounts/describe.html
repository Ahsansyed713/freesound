{% extends "base.html" %}
{% load filefunctions %}
{% block title %}{{ block.super }}Describe{% endblock %}
{% block head %}
{{ block.super }}
<script type="text/javascript">
    var checkedAll = false;

    function select_ul(element)
    {
        checkedAll = !checkedAll;
        $(element.parentNode).find("input").attr('checked', checkedAll);
        $("#fileform").find("option").attr('selected', checkedAll);
        $('#select_all').text(checkedAll ? 'deselect all' : 'select all');
    }

    function checkboxChange(checkbox)
    {
        var option = $("#fileform").find("option[value=" + checkbox.name + "]").get(0);
        if (checkbox.checked)
            option.selected = true;
        else
            option.selected = false;
    }
</script>
{% endblock %}
{% block content %}
<div id="describe_page">
    <h1>Describe</h1>

    {% if not n_files %}
        <h3>No files to describe</h3>
        <p>
            It looks like you have not uploaded any audio files yet or all your files have already been described.
            <br>Please <a href="{% url 'accounts-upload' %}">upload some more files</a> before comming back here :)
        </p>

    {% else %}

        <h3>Describe files manually</h3>
        <p>You've uploaded these files, but they won't appear on the website until you've described them.
            <br>Select the files you want to describe, click on "describe selected files", and follow the instructions on the following pages.
            <br> You can also delete files by selecting them and pressing the "delete selected files" button.
        <div id="content">
            <div class="content_box">
                <h3>Your uploaded files ({{ n_files }})</h3>
                <p>
                <ul id="root_file" class="upload">
                    {% show_file file_structure 1 %}
                </ul>
                </p>
            </div>
        </div>
        <div id="sidebar">
            <div class="content_box">
                <h3>Actions</h3>
                <p>
                <form action="." method="post" id="fileform">{% csrf_token %}
                    <div style="display:none">
                    {{form.as_p}}
                    </div>
                    <input class="describe_page_action_button" type="submit" value="Describe selected files" name="describe">
                    <br><input class="describe_page_action_button" type="submit" value="Delete selected files" name="delete">
                </form>
                </p>
            </div>
        </div>

        <!-- Bulk upload part -->
        {% if request.user.profile.can_do_bulk_upload %}
            <br style="clear: both;">
            <h3>Describe many files in batch</h3>
            <p>
                You can also provide descriptions for many files at once by <b>uploading a data file in CSV or XLS</b> format.
                Please use the <a href="{{ media_url }}/sample.csv" target="_blank">CSV</a>, <a href="{{ media_url }}/sample.xls" target="_blank">XLS</a>
                or <a href="{{ media_url }}/sample.xlsx" target="_blank">XLSX</a> template to create your data file, and read
                <a href="{% url 'wiki-page' 'faq' %}#csv-file-instructions">these instructions</a> to know how to fill
                in all sound description fields. Upload your data file using the form below:
            </p>
            <form method="POST" enctype="multipart/form-data" action="">
                {% csrf_token %}
                {{csv_form}}
                <input type="submit" name="Submit" value="Upload data file"/>
            </form>
            <ul class="messages">
                <li>This feature is still in <b>beta</b>. If you experience any problems using it, please
                    don't hesitate to <a href="{% url 'contact' %}">contact us</a> and report.</li>
            </ul>
        {% endif %}
    {% endif %}
</div>
{% endblock %}
