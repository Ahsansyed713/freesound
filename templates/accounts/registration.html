{% extends "accounts/_section.html" %}
{% load util %}
{% block title %}registration{% endblock %}

{% block section_content %}
<style> label[for=id_accepted_tos] {display: inline} #username_check, #check_success, #spinner { display:none; color: #bd2d33; font-style: italic; } #check_success {color:green;}</style>
<script type="text/javascript">
    $(function () {
      $("#id_username").focus()
      
        $('#id_username').parent().append('<div id="spinner"> Checking...<img src="{{ media_url }}images/indicator.gif" /></div><div id="username_check">Sorry, this username is already being used by someone else.</div><div id="check_success">Username is available</div>');
      
      // When the user enters a username we check if it's available
      $("#id_username").focusout(function(){
        if ($("#id_username").val()) {
          $('#spinner').show();
          $('#username_check').hide();
          $('#check_success').hide();
          $.get('{% url "check_username" %}', 
              {'username': $("#id_username").val()}, 
              function(data){
                $('#username_check').toggle(!data.result);
                $('#spinner').hide();
                $('#check_success').toggle(data.result);
              }, "json" );
        }
      });
    });    
</script>

<h1>Registration</h1>

    <h3>
        We check uploads and forum posts for spam before others can see them. Any user that posts spam will be deleted.
    </h3>

    <form method="post" action="." class="disable-on-submit">{% csrf_token %}
        {{ form.non_field_errors }}
        {% for field in form.visible_fields %}
            {{ field.errors }}
            {% if field|is_checkbox %}
                <p>
                    {{ field }} {{ field.label }}<span class="helptext">{{ field.help_text }}</span>
                </p>
            {% else %}
                <p>
                    <label for="{{ field.id }}">{{ field.label_tag }}</label>{{ field }}
                    <span class="helptext">{{ field.help_text }}</span>
                </p>
            {% endif %}
        {% endfor %}
        <span class="help-block"> {{ form.recaptcha_response.errors }} </span>
        <script src="https://www.google.com/recaptcha/api.js" async defer></script>
        <div class="g-recaptcha" data-sitekey={{ form.captcha_key}}></div>
        <br><input type="submit" value="Register" />
    </form>

{% include "accounts/reminders.html" %}

{% endblock %}
