package  {    import ui.ISoundDisplayObserver;            import flash.events.EventPhase;            import mx.controls.ButtonPhase;            import ui.IButton;    import ui.IButtonObserver;    import ui.ImageButton;    import ui.SoundDisplay;    import flash.display.Bitmap;    import flash.display.Sprite;    import flash.events.MouseEvent;            /**     * @author bram     */    [SWF( backgroundColor='0xffffff', width='900', height='200')]    public class Flash10Player extends Sprite implements ISoundManagerObserver, IButtonObserver, ISoundDisplayObserver    {        private var _soundDisplay : SoundDisplay;        private var _baseUrl : String, _waveformUrl : String, _spectralUrl : String, _soundUrl : String;        private var _sound : BasicSoundManager;        [Embed(source='../media/play.png')]        private var PlayButtonImage : Class;        private var playButton : ImageButton;        [Embed(source='../media/stop.png')]        private var StopButtonImage : Class;        private var stopButton : ImageButton;                [Embed(source='../media/spectral.png')]        private var SpectralButtonImage : Class;        private var spectralButton : ImageButton;        [Embed(source='../media/loop.png')]        private var LoopButtonImage : Class;        private var loopButton : ImageButton;                private var _hidingSprite:Sprite;        public function Flash10Player()        {            _baseUrl = "../media/";            _waveformUrl = "waveform.png";            _spectralUrl = "spectral.jpg";            _soundUrl = "preview.mp3";            buildUi();        }            	public function onClick(soundDisplay:SoundDisplay, procent:Number):void    	{	        if (!_sound)	        {	            _sound = new BasicSoundManager(_baseUrl + _soundUrl);	            _sound.addSoundManagerObserver(this);	        }	        _sound.jump(procent);    	}        public function onButtonDown(button : IButton) : void        {            switch (button)            {                case playButton:                    {	                    if (!_sound)			            {			                _sound = new BasicSoundManager(_baseUrl + _soundUrl);			                _sound.addSoundManagerObserver(this);			            }			        				        	_sound.play();	                    break;	        		}	        	case stopButton:		        	{		        		if (_sound)		        			_sound.stop();		        		break;		        	}		        case spectralButton:		        	{		        		if (_soundDisplay)		        			_soundDisplay.swapDisplayImage();		        		break;		        	}		        case loopButton:			        {			        	if (_sound)			        		_sound.loop = true;			        	break;			        }            }        }                public function onButtonUp(button:IButton):void        {            switch (button)            {                case playButton:                    {		        		if (_sound)		                	_sound.pause();	                    break;	        		}		        case spectralButton:		        	{		        		if (_soundDisplay)		        			_soundDisplay.swapDisplayImage();		        		break;		        	}		        case loopButton:			        {			        	if (_sound)			        		_sound.loop = false;			        	break;			        }            }        }        private function buildUi() : void        {            _soundDisplay = new SoundDisplay(900, 149, _baseUrl + _waveformUrl, _baseUrl + _spectralUrl);            _soundDisplay.addSoundDisplayObserver(this);            addChild(_soundDisplay);            playButton = new ImageButton(new PlayButtonImage(), true);            playButton.addButtonObserver(this);            playButton.x = 0;            playButton.y = 149-11;            addChild(playButton);                        _hidingSprite = new Sprite();        	            stopButton = new ImageButton(new StopButtonImage());            stopButton.addButtonObserver(this);            stopButton.x = 12;            stopButton.y = 149-11;            _hidingSprite.addChild(stopButton);            spectralButton = new ImageButton(new SpectralButtonImage(), true);            spectralButton.addButtonObserver(this);            spectralButton.x = 24;            spectralButton.y = 149-11;            _hidingSprite.addChild(spectralButton);            loopButton = new ImageButton(new LoopButtonImage(), true);            loopButton.addButtonObserver(this);            loopButton.x = 36;            loopButton.y = 149-11;            _hidingSprite.addChild(loopButton);                        addEventListener(MouseEvent.MOUSE_OVER, onMouseOver);            addEventListener(MouseEvent.MOUSE_OUT, onMouseOut);        }                private function onMouseOver(e:MouseEvent):void        {            if (!contains(_hidingSprite))	            addChild(_hidingSprite);        }        private function onMouseOut(e:MouseEvent):void        {            if (contains(_hidingSprite))	            removeChild(_hidingSprite);        }        public function onSoundManagerLoading( soundManager : ISoundManager, progress : Number ) : void        {            _soundDisplay.setSoundDuration(_sound.duration);            _soundDisplay.setLoading(progress);        };        public function onSoundManagerError( soundManager : ISoundManager, errorMsg : String ) : void        {        	// TODO: gracefully display fail message. Epic fail!        };        public function onSoundManagerLoaded(soundManager : ISoundManager) : void        {            _soundDisplay.setSoundDuration(_sound.duration);            _soundDisplay.setLoading(1.0);        };        public function onSoundManagerPlay(soundManager : ISoundManager) : void        {            playButton.setState(true);        };        public function onSoundManagerPlaying( soundManager : ISoundManager, position : Number ) : void        {            _soundDisplay.setPlaying(position);        };        public function onSoundManagerPause(soundManager : ISoundManager) : void        {            playButton.setState(false);        };        public function onSoundManagerStop(soundManager : ISoundManager) : void        {            playButton.setState(false);        };    }}