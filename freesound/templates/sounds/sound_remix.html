{% extends "sounds/_section.html" %}

{% load display_sound %}
{% block head %}
{{ block.super }}
<script type="text/javascript">
    function callback(soundId)
    {
        var oldValue = $("#id_sources").val();

        oldValue = oldValue.replace(/[^0-9,]/g, "").replace(/,+/g, ",").replace(/^,+/g, "").replace(/,+$/g, "");

        if (oldValue)
            var ids = $.map(oldValue.split(","), function (value) { return parseInt(value); });
        else
            var ids = [];
        
        if ($.inArray(soundId, ids) != -1)
            return;
        
        oldValue = ids.join(",")

        if (oldValue)
            $("#id_sources").val(oldValue + "," + soundId);
        else
            $("#id_sources").val(soundId);
    }
        
    $(function()
    {
        $("#search-button").click(function ()
        {
            var queryString = $.param({q: $("#search-q").val(), ajax: 1});
            $("#data").load("{% url sounds-search %}", queryString);
        });
        
        $("#save-sources").click(function ()
        {
            $.post("{% url remix-sources sound.user.username sound.id %}", $("#save-source-form").serialize());
        });
    });
</script>
{% endblock head %}

{% block title %}Editing remixes of {{sound.original_filename}}{% endblock title %}

{% block section_content %}

<h2>Editing sources of <a href="{% url sound sound.user.username sound.id %}">{{sound.original_filename}}</a></h2>
<p>
    <input type="text" name="q" id="search-q" />
    <input type="submit" name="submit" value="submit" id="search-button"/>
</p>

<form method="post" action=".">{% csrf_token %}
    {{form.as_p}}
    <input type="submit" name="submit" value="save sources" id="save-sources" />
</form>

<div id="data">
</div>

{% endblock section_content %}