{% extends "base.html" %}
{% load display_license_form %}

{% block head %}
	{{ block.super }}
	<script>
  		$(document).ready(function() {
  			$(".inner-accordion").accordion();
    		$(".outer-accordion").accordion();
  		});
    </script>
    <script src="http://localhost:8000/fsmedia/js/jquery-ui-1.8.11.custom.min.js" type="text/javascript"></script>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key={{google_api_key}}" type="text/javascript"></script> 
{% endblock head %}



{% block title %}{{ block.super }}Describe - choose pack{% endblock %}



{% block content %}
	<form action="." method="POST">
	<div class="outer-accordion">
	{% for form in forms %}
		<h3>{{ form.sound.name }}</h3>
		<div class="inner-accordion outer-accordion-div">
	    	<h4><a href="#">Tags and Description</a></h4>
	    	<div class="inner-accordion-div">
	    		{{ form.description.as_p }}
	    	</div>
	    	<h4><a href="#">Geotag</a></h4>
	    	<div class="inner-accordion-div">
	    		<div class="describe-gmap" id="gmap{{forloop.counter}}" style="width: 400px; height:300px;"></div>
	    		<div class="describe-geotag-form">{{ form.geotag.as_p }}</div>
	    		<script type="text/javascript">
				    var map = new GMap2($("#gmap{{forloop.counter}}").get(0));
				    
				    var initialCenter = new GLatLng(23.885837699862005,21.796875);
				    var initialZoom = 2;
				
				    map.setCenter(initialCenter, initialZoom);
				    
				    map.setMapType( G_HYBRID_MAP );
				 	map.disableScrollWheelZoom();
				    map.enableContinuousZoom();
				    map.addControl(new GSmallMapControl());
				    map.addControl(new GMapTypeControl());
				    
				    var centerIcon = new GIcon();
				    centerIcon.image = "http://www.freesound.org/geotagging/arrow.png";
				    centerIcon.iconSize = new GSize(25, 24);
				    centerIcon.shadowSize = new GSize(0, 0);
				    centerIcon.iconAnchor = new GPoint(0, 24);
				    centerIcon.infoWindowAnchor = new GPoint(25, 0);
				    
				    var centerMarker = new GMarker(initialCenter, centerIcon);
				    map.addOverlay(centerMarker);
				
				    GEvent.addListener(map, "move", updateAndAddCenter);
				
				    updateAndAddCenter()
		
					function updateAndAddCenter()
				    {
				        var center = map.getCenter();
				        var zoom = map.getZoom();
				        // update form
				        if (!$("#{{form.geotag.remove_geotag.auto_id}}").checked)
				        {
				            $("#{{form.geotag.lon.auto_id}}").val(center.lng());
				            $("#{{form.geotag.lat.auto_id}}").val(center.lat());
				            $("#{{form.geotag.zoom.auto_id}}").val(zoom);
				        }
				        centerMarker.setLatLng(center);
				    }
			
				    $("#{{form.geotag.remove_geotag.auto_id}}").change(function (event) {
				        if (this.checked)
				        {
				            $("#{{form.geotag.lon.auto_id}}").attr('disabled', 'disabled').val("");
				            $("#{{form.geotag.lat.auto_id}}").attr('disabled', 'disabled').val("");
				            $("#{{form.geotag.zoom.auto_id}}").attr('disabled', 'disabled').val("");
				        }
				        else
				        {
				            $("#{{form.geotag.lon.auto_id}}").attr('disabled', false);
				            $("#{{form.geotag.lat.auto_id}}").attr('disabled', false);
				            $("#{{form.geotag.zoom.auto_id}}").attr('disabled', false);
				            updateAndAddCenter();
				        }
				    });
				</script>
	    	</div>
	    	<h4><a href="#">Pack</a></h4>
	    	<div class="inner-accordion-div">
	    		{{ form.pack.as_p }}
	    	</div>
	    	<h4><a href="#">License</a></h4>
	    	<div class="inner-accordion-div">
	    		{% display_license_form form.license %}
	    	</div>
	    	{% comment %}
	    	<!-- cannot include this right now because the remix sources form needs a sound object --> 
	    	<h4><a href="#">Remix Sources</a></h4>
	    	<div class="inner-accordion-div">
	    		{{ form.remix.as_p }}
	    	</div>
	    	{% endcomment %}
		</div>
	{% endfor %}
	</div>
	</form>

{% endblock %}